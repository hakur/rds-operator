kind: Redis
apiVersion: rds.hakurei.cn/v1alpha1
metadata:
  name: redis
spec:
  imagePullPolicy: IfNotPresent
  storageClassName: hostpath
  password: abc
  masterReplicas: 3
  dataReplicas: 1
  timeZone: Asia/Shanghai
  redis:
    image: docker.io/bitnami/redis-cluster:6.2.5
    storageSize: 1Gi
    backupMethod: AOF
    command:
    - /bin/bash
    - -c
    args: 
    - |
      if ! [[ -f /opt/bitnami/redis/etc/redis.conf ]]; then
        cp /opt/bitnami/redis/etc/redis-default.conf /opt/bitnami/redis/etc/redis.conf
      fi

      podIndex=${HOSTNAME##*-}
      if [ $podIndex == 0 ]; then
        export REDIS_CLUSTER_CREATOR="yes"
      fi
      
      /opt/bitnami/scripts/redis-cluster/entrypoint.sh /opt/bitnami/scripts/redis-cluster/run.sh
  proxy:
    image: rumia/redis-cluster-proxy:1.0-beta2
    replicas: 1
    nodePort: 0
  
  